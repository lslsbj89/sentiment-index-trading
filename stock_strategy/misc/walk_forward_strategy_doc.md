# Walk Forward 策略评估与参数优化系统

## 1️⃣ 项目目标

为技术指标型量化策略提供：

1. **历史稳健性验证**：通过 Walk Forward 验证策略在不同市场环境下的稳定性
2. **参数优化与稳健选择**：训练窗口内搜索最优参数，输出稳健区间
3. **实盘部署参考**：生成可直接用于未来 1 年实盘的参数推荐
4. **策略评级**：单股、组合及参数稳定性自动打分

## 2️⃣ 核心概念

| 名称 | 含义 |
|------|------|
| **训练窗口** | 用历史连续 N 年数据进行参数搜索（推荐 4 年） |
| **测试窗口** | 紧随训练窗口之后的未来 1 年，用最优参数进行回测 |
| **Walk Forward** | 滚动训练-测试窗口组合，覆盖整个历史数据周期 |
| **稳健参数区** | 多个训练窗口中参数集中分布的高密度区域 |
| **策略评级** | 基于盈利窗口率、Sharpe、回撤等指标自动打分（🟢🟡🔴） |

## 3️⃣ 数据要求

- **标的**：七姐妹（AAPL, MSFT, NVDA, AMZN, META, GOOGL, TSLA）  
- **周期**：日线  
- **价格类型**：复权收盘价  
- **交易成本**：默认单边 0.05%（可配置）  
- **指标数据**：策略所需的技术指标（MA, RSI, ATR 等）  

## 4️⃣ Walk Forward 结构

### 4.1 窗口配置

- **训练期**：4 年连续历史数据  
- **测试期**：1 年  
- **前滚步长**：1 年

示例：

| 窗口 | 训练 | 测试 |
|------|------|------|
| 1 | 2014–2017 | 2018 |
| 2 | 2015–2018 | 2019 |
| 3 | 2016–2019 | 2020 |
| 4 | 2017–2020 | 2021 |

### 4.2 流程

1. **训练窗口**：
   - 参数搜索（网格或随机）  
   - 评分函数 = Sharpe - 0.5 × MaxDrawdown  
   - 输出每个参数的评分

2. **测试窗口**：
   - 使用训练期最优参数回测  
   - 输出指标：收益、Sharpe、最大回撤、交易次数  
   - 判断是否盈利

3. **滚动窗口**：
   - 每次训练窗口前滚 1 年  
   - 覆盖整个历史周期

## 5️⃣ 参数稳健性分析

- **统计训练窗口最优参数分布**  
- **计算均值、标准差、稳健区间**  
- **可视化**：
  - 热力图（窗口 vs 参数值，颜色表示 Sharpe 或评分）  
  - 稳健区标记高密度区域  
- **部署策略参数选择**：
  - 取稳健区中心或均值附近，而不是单个最优点

## 6️⃣ 测试指标

| 指标 | 单股要求 | 七姐妹组合 |
|------|---------|-----------|
| 测试窗口盈利率 | ≥60% | ≥65% |
| 测试 Sharpe | ≥0.8 | ≥1 |
| 最大回撤 | ≤训练期 × 1.5 | ≤组合训练回撤 × 1.5 |
| 参数稳健性 | 稳健区宽度适中 | 高密度区一致性 |

## 7️⃣ 输出报告

1. **每个窗口指标表**：
   ```
   Window | Train Sharpe | Test Return | Test Sharpe | Pass
   ```
2. **参数分布统计**：
   - 均值、标准差、稳健区  
3. **热力图**：
   - 可视化参数波动和稳健区  
4. **策略最终评级**：
   - 🟢 可实盘  
   - 🟡 观察池  
   - 🔴 淘汰

## 8️⃣ 软件实现建议

- **编程语言**：Python  
- **核心依赖**：
  - pandas / numpy（数据处理）
  - matplotlib / seaborn（可视化）
  - optional: backtrader / vectorbt（回测引擎）
- **模块化设计**：
  1. 数据读取与指标计算模块  
  2. 参数搜索模块（网格 / 随机）  
  3. Walk Forward 主循环模块  
  4. 测试窗口回测模块  
  5. 稳健性统计与可视化模块  
  6. 输出报告与策略评级模块

- **支持批量标的**：一次跑七姐妹组合  
- **配置文件**：训练期长度、测试期长度、指标参数空间、交易成本等可修改

