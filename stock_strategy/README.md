# 情绪交易策略 (Sentiment Trading Strategy)

基于情绪指数 (smoothed_index) 的量化交易策略，在美股七姐妹 (Magnificent 7) 和其他股票上进行系统性测试和验证。

## 策略概述

### 核心逻辑
```
买入: 情绪指数 < 阈值 (恐惧时买入)
卖出: 情绪指数 > 阈值 (贪婪时卖出) OR (情绪 > X AND 价格 < MA50)
```

### 数据来源
- **情绪指数**: smoothed_index (Fear & Greed Index 平滑处理)
- **价格数据**: PostgreSQL 数据库 (OHLCV)
- **技术指标**: MA50 (50日移动平均线)

---

## 最终推荐配置

经过 21 个实验验证，推荐以下统一参数配置：

### 统一参数表

| 股票 | 买入条件 | 卖出条件 | 仓位管理 |
|------|---------|---------|---------|
| **NVDA** | <-10 | (>10 AND <MA50) OR >40 | 动态复利 |
| **TSLA** | <-10 | (>10 AND <MA50) OR >40 | 动态复利 |
| **GOOGL** | <-5 | (>10 AND <MA50) OR >40 | 固定仓位 |
| **META** | <-10 | (>5 AND <MA50) OR >40 | 动态复利 |
| **MSFT** | <-10 | (>10 AND <MA50) OR >40 | 固定仓位 |
| **AAPL** | <-10 | (>10 AND <MA50) OR >40 | 固定仓位 |
| **AMZN** | <-10 | (>5 AND <MA50) OR >40 | 固定仓位 |

### 参数说明

**买入条件**:
- `<-10`: 情绪指数低于 -10 时买入（恐惧）
- `<-5`: GOOGL 情绪波动小，放宽入场条件

**卖出条件**:
- `AND 止损`: 情绪 > X 且价格 < MA50（双重确认）
- `OR >40`: 情绪极度贪婪时强制卖出（保险机制）

**仓位管理**:
- `动态复利`: 当前总资产 × 80%（多次交易股票）
- `固定仓位`: 初始资金 × 80%（单次交易股票）

---

## 回测结果

### 2021-2025 五年收益

| 股票 | 5年收益 | 年化 | 最大回撤 | 夏普率 | 交易次数 | 胜率 |
|------|--------|------|---------|--------|---------|------|
| **NVDA** | +773% | 54% | -60% | 1.25 | 5 | 80% |
| **TSLA** | +227% | 27% | -61% | 0.76 | 4 | 75% |
| **GOOGL** | +209% | 25% | -39% | 0.98 | 1 | 100% |
| **META** | +143% | 19% | -65% | 0.71 | 3 | 100% |
| **MSFT** | +99% | 15% | -32% | 0.75 | 1 | 100% |
| **AAPL** | +91% | 14% | -30% | 0.67 | 1 | 100% |
| **AMZN** | +44% | 8% | -46% | 0.41 | 3 | 67% |
| **平均** | **+227%** | **23%** | -48% | **0.79** | 18 | - |

### 2016-2020 样本外验证

| 股票 | 5年收益 | 年化 | 验证结果 |
|------|--------|------|---------|
| **NVDA** | +1115% | 65% | 有效 |
| **TSLA** | +381% | 37% | 有效 |
| **AAPL** | +293% | 31% | 有效 |
| **AMZN** | +175% | 22% | 有效 |
| **MSFT** | +135% | 19% | 有效 |
| **META** | +126% | 18% | 有效 |
| **GOOGL** | +107% | 16% | 有效 |

**验证通过率: 7/7 = 100%**

### 十年复合收益 (2016-2025)

| 股票 | 10年累计 | 年化收益 |
|------|---------|---------|
| **NVDA** | +8,428% | 56% |
| **TSLA** | +1,760% | 34% |
| **AAPL** | +633% | 22% |
| **GOOGL** | +539% | 20% |
| **META** | +449% | 19% |
| **MSFT** | +367% | 17% |
| **AMZN** | +297% | 15% |

---

## 策略分类

### 第一类：高成长股 (NVDA, TSLA)
```python
BUY_THRESHOLD = -10
SELL_CONDITION = "(sentiment > 10 AND price < MA50) OR sentiment > 40"
POSITION = "动态复利"  # 总资产 × 80%
```
- 多次交易（3-5次/5年）
- 动态复利效果显著
- AND 条件止损最优

### 第二类：波段股 (META, AMZN)
```python
BUY_THRESHOLD = -10
SELL_CONDITION = "(sentiment > 5 AND price < MA50) OR sentiment > 40"
POSITION = "动态复利"
```
- 需要更敏感的卖出条件
- 技术面+情绪面双重确认

### 第三类：稳定蓝筹 (AAPL, MSFT)
```python
BUY_THRESHOLD = -10
SELL_CONDITION = "(sentiment > 10 AND price < MA50) OR sentiment > 40"
POSITION = "固定仓位"  # 初始资金 × 80%
```
- 5年只有1次交易
- 动态复利无效
- 简单持有即可

### 第四类：低波动股 (GOOGL)
```python
BUY_THRESHOLD = -5  # 放宽买入条件
SELL_CONDITION = "(sentiment > 10 AND price < MA50) OR sentiment > 40"
POSITION = "固定仓位"
```
- 情绪波动小
- 需放宽入场条件

---

## 新股票测试

### 测试结果

| 股票 | 最优配置 | 5年收益 | 年化 | 夏普 | 结论 |
|------|---------|--------|------|------|------|
| **HOOD** | buy<-5, AND止损 | +340% | 35% | 0.96 | 适用 |
| **COIN** | buy<-10, >30 | +73% | 12% | 0.48 | 适用 |
| **UBER** | buy<-5, AND止损 | +69% | 11% | 0.47 | 适用 |
| **BABA** | 任意 | -29% | -7% | -0.04 | 不适用 |

### 策略适用性

| 股票类型 | 代表 | 建议 |
|---------|------|------|
| 高波动成长股 | HOOD | buy<-5, AND止损, 动态复利 |
| 加密相关股 | COIN | buy<-10, 长期持有(>30) |
| 低波动股 | UBER | buy<-5, 放宽入场条件 |
| 单边下跌股 | BABA | **不适用情绪策略** |

---

## 核心结论

### 策略有效性
1. **跨周期验证通过** - 2016-2020 和 2021-2025 都有效
2. **平均年化收益 23%** - 远超标普 500
3. **夏普率 0.79** - 风险调整后收益良好

### 关键发现
1. **恐惧时买入有效** - 情绪 < -10 确实能买到更低价格
2. **AND 止损优于单一阈值** - 双重确认避免假信号
3. **OR >40 是最佳平衡点** - 极度贪婪时的保险机制
4. **动态复利威力巨大** - NVDA: $100k → $873k

### 策略边界
- 适合: 高波动成长股（七姐妹、HOOD、COIN）
- 需调整: 低波动股（GOOGL、UBER）放宽买入阈值
- 不适合: 基本面恶化的单边下跌股（BABA）

---

## 文件结构

```
sentiment_strategy/
├── README.md                      # 本文档
├── EXPERIMENT_LOG.md              # 21个实验详细记录
│
├── 核心脚本
│   ├── sentiment_only_strategy.py # Walk-Forward 验证
│   ├── test_mag7.py               # 七姐妹固定阈值测试
│   ├── test_new_stocks.py         # 新股票网格搜索
│   ├── unified_params_test.py     # 统一参数测试
│   ├── unified_params_2016_2020.py# 统一参数样本外验证
│   └── backtest_2016_2020.py      # 2016-2020 验证
│
├── 可视化脚本
│   ├── visualize_2025.py          # 2025年可视化
│   ├── new_stocks_visualize.py    # 新股票可视化
│   ├── yearly_backtest_visualize.py
│   └── continuous_backtest_visualize.py
│
├── 实验脚本
│   ├── fixed_threshold.py         # 固定阈值测试
│   ├── ma_sentiment_stop.py       # AND条件测试
│   ├── and_condition_dynamic.py   # 动态复利测试
│   ├── relaxed_exit_conditions.py # 放宽卖出条件
│   └── ...
│
└── 输出目录
    ├── continuous_backtest_results/  # 连续复利结果
    ├── yearly_backtest_results/      # 年度独立结果
    ├── new_stocks_results/           # 新股票结果
    └── backtest_2016_2020_results/   # 2016-2020 验证
```

---

## 快速开始

### 运行最优策略回测
```bash
cd sentiment_strategy
python continuous_backtest_visualize.py
```

### 测试新股票
```bash
python test_new_stocks.py
python new_stocks_visualize.py
```

### 验证历史数据
```bash
python backtest_2016_2020.py
```

---

## 实验历史

| 实验 | 内容 | 结论 |
|------|------|------|
| 1 | 止盈止损 vs 无 | 去掉止盈止损更好 |
| 2-3 | Walk-Forward 验证 | 3年训练足够 |
| 4 | 固定阈值测试 | <-10, >30 效果好 |
| 5-9 | 七姐妹网格搜索 | 每只股票最优参数 |
| 10-11 | AND 条件测试 | AND止损优于阈值 |
| 12-13 | 动态复利 | 多次交易时有效 |
| 14 | 最优配置验证 | 平均收益 210% |
| 15 | GOOGL 优化 | 放宽买入阈值至 <-5 |
| 16-17 | 可视化完善 | 年度独立 vs 连续复利 |
| 18 | 新股票测试 | HOOD +340%, BABA 失败 |
| 19 | 2016-2020 验证 | 100% 验证通过 |
| 20 | 统一参数测试 | OR >40 最佳 |
| 21 | 统一参数验证 | 跨周期有效 |

---

## 版本历史

- **v1.0** (2026-01-12): 初始版本，21个实验完成
- 实验周期: 2026-01-10 ~ 2026-01-12
- 测试股票: 11只 (七姐妹 + HOOD, COIN, UBER, BABA)
- 回测周期: 10年 (2016-2025)

---

**作者**: Claude Code
**日期**: 2026-01-12
