# 间隔分批买入策略 - 实验总结

## 核心结论

1. **间隔分批买入 vs 原版阈值分批**: 平均收益 +411% vs +324%，提升 +87%，资金利用率从 25-100% 提升至 ~100%
2. **最优买入阈值**: buy<0 平均最优 (+431.5%)，4/7 股票最优；buy<5 次优 (+410.9%)
3. **联合优化过拟合**: 训练期联合搜索买入+卖出参数导致过拟合 (+513% vs +1451%)，固定保守参数更稳健
4. **各股票最优阈值不同**: NVDA/MSFT/AMZN/META→buy<0, AAPL→buy<5, GOOGL→buy<-5, TSLA→buy<-15

### 固定参数回测结果 (buy<5, 7天间隔, 20%批次)

| 股票 | 总收益 | 胜率 |
|------|--------|------|
| NVDA | +1451.4% | 100.0% |
| TSLA | +427.8% | 75.0% |
| AAPL | +302.9% | 100.0% |
| GOOGL | +259.2% | 75.0% |
| MSFT | +183.0% | 0.0% |
| AMZN | +142.2% | 66.7% |
| META | +110.0% | 75.0% |
| **平均** | **+410.9%** | - |

### 买入阈值对比

| 股票 | buy<-15 | buy<-10 | buy<-5 | buy<0 | buy<5 | 最优 |
|------|---------|---------|--------|-------|-------|------|
| NVDA | +185.7% | +174.1% | +250.1% | **+1510.7%** | +1451.4% | buy<0 |
| TSLA | **+517.1%** | +397.0% | +405.6% | +413.3% | +427.8% | buy<-15 |
| AAPL | +57.6% | +140.3% | +295.0% | +275.6% | **+302.9%** | buy<5 |
| MSFT | +71.7% | +75.7% | +217.4% | **+219.8%** | +183.0% | buy<0 |
| GOOGL | +96.7% | +74.2% | **+282.1%** | +269.0% | +259.2% | buy<-5 |
| AMZN | +15.0% | +5.0% | +63.7% | **+171.4%** | +142.2% | buy<0 |
| META | -1.7% | +80.0% | +62.1% | **+160.5%** | +110.0% | buy<0 |
| **平均** | +134.6% | +135.2% | +225.1% | **+431.5%** | +410.9% | **buy<0** |

---

## 策略概述

基于 Fear & Greed Index (S3, Smoothing=3, MoneyFlow=13) 的情绪驱动交易策略。

---

## 买入策略 (测试期: 间隔分批买入)

**核心逻辑**: 情绪低迷时分批建仓，情绪恢复时全仓买入

| 参数 | 值 | 说明 |
|------|------|------|
| buy_threshold | 5 | 情绪指数 < 5 触发买入模式 |
| interval_days | 7 | 每隔 7 天买入一批 |
| batch_pct | 20% | 每批买入基础资金的 20% |

**执行流程**:
1. 当 sentiment < 5 → 进入买入模式，立即买入首批 (20%)
2. 买入模式中，每隔 7 天 → 再买入一批 (20%)
3. 当 sentiment 回升 >= 5 → 一次性买入剩余全部仓位，退出买入模式

**设计优势**: 解决原版阈值分批买入资金利用率不足的问题 (25-100% → ~100%)

## 买入策略 (训练期: 原版阈值分批)

训练期使用原版策略进行网格搜索，确定卖出参数:

| 参数 | 值 | 说明 |
|------|------|------|
| buy_thresholds | [5, 0, -5, -10] | 4 档买入阈值 |
| batch_pct | 25% | 每档买入 25% |

---

## 卖出策略 (训练期/测试期相同)

**双条件卖出机制**: OR 条件 + AND 条件

| 条件 | 触发规则 | 说明 |
|------|---------|------|
| OR 条件 | sentiment > OR阈值 | 情绪过热，无条件卖出 |
| AND 条件 | sentiment > AND阈值 **且** price < MA50 | 情绪偏高 + 价格走弱，卖出 |

**卖出参数**: 由训练期网格搜索确定 (每个窗口独立优化)
- AND 阈值搜索范围: [5, 10, 15, 20, 25]
- OR 阈值搜索范围: [30, 40, 50, 55, 60]

---

## Walk-Forward 验证框架

| 窗口 | 训练期 | 测试期 |
|------|--------|--------|
| W2020 | 2016-01-01 ~ 2019-12-31 | 2020-01-01 ~ 2020-12-31 |
| W2021 | 2017-01-01 ~ 2020-12-31 | 2021-01-01 ~ 2021-12-31 |
| W2022 | 2018-01-01 ~ 2021-12-31 | 2022-01-01 ~ 2022-12-31 |
| W2023 | 2019-01-01 ~ 2022-12-31 | 2023-01-01 ~ 2023-12-31 |
| W2024 | 2020-01-01 ~ 2023-12-31 | 2024-01-01 ~ 2024-12-31 |
| W2025 | 2021-01-01 ~ 2024-12-31 | 2025-01-01 ~ 2025-12-31 |

- 4 年训练 + 1 年测试，滚动前进
- 资金在窗口间连续传递 (非重置)
- 初始资金: $100,000

---

## 联合优化实验 (负面案例)

尝试在训练期也使用间隔分批买入进行网格搜索:
- 搜索空间: buy_threshold × interval_days × AND × OR = 400 组合
- NVDA 结果: +513.2% (远低于固定参数 +1451.4%)
- **结论**: 典型过拟合，固定保守参数优于数据驱动搜索

---

## 其他回测参数

| 参数 | 值 |
|------|------|
| 手续费 | 0.1% |
| 滑点 | 0.1% |
| MA50 | 50 日移动平均线 |
| 数据源 | fear_greed_index_s3 (S3, MF=13) |
| 数据库 | PostgreSQL crypto_fear_greed_2 |

---

## 文件清单

| 文件 | 说明 |
|------|------|
| `threshold_interval_buy.py` | 固定参数版本 (生产) |
| `threshold_interval_buy_optimized.py` | 联合优化版本 (过拟合案例) |
| `compare_buy_thresholds.py` | 买入阈值对比实验 |
| `interval_buy_summary_*.csv` | 固定参数结果 |
| `interval_buy_trades_*.csv` | 交易明细 |
| `compare_buy_thresholds_*.csv` | 阈值对比结果 |

---

*生成日期: 2026-01-28*
